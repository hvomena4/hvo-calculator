<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="theme-color" content="#ffffff" id="metaThemeColor">
<script>
(function(){
  var t = localStorage.getItem('theme');
  if(t==='dark'){
    document.documentElement.setAttribute('data-theme','dark');
    document.documentElement.style.backgroundColor='#000000';
    document.getElementById('metaThemeColor').content='#000000';
  }
})();
</script>
<title>HVO â€” Dubbing Cost Calculator</title>
<link href="https://api.fontshare.com/v2/css?f[]=switzer@100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
<link rel="preload" href="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/OUTER.svg?alt=media&token=394d9498-5f0e-4e25-8ee3-9e2a3b627520" as="image">
<link rel="preload" href="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/INNER.svg?alt=media&token=fe5271b9-275b-4e10-aad8-6888b197abc9" as="image">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

/* Light Mode (default) */
:root{
  --bg:#ffffff;
  --bg2:#f8f8f8;
  --bg3:#f0f0f0;
  --bg4:#e5e5e5;
  --bdr:#e0e0e0;
  --bdr2:#d0d0d0;
  --txt:#111;
  --txt2:#555;
  --txt3:#888;
  --red:#dc2626;
  --red2:#b91c1c;
  --green:#22c55e;
  --blue:#2563eb;
  --card-bg:#fff;
  --card-bdr:#e0e0e0;
  --input-bg:#f5f5f5;
  --btn-bg:#e5e5e5;
  --btn-hover:#d5d5d5;
  --pad:24px;
  --gap:24px;
  --radius:14px;
  --radius-sm:10px;
}

/* Dark Mode */
[data-theme="dark"]{
  --bg:#000000;
  --bg2:#0a0a0a;
  --bg3:#111111;
  --bg4:#1a1a1a;
  --bdr:#1a1a1a;
  --bdr2:#252525;
  --txt:#fff;
  --txt2:#a0a0a0;
  --txt3:#666;
  --card-bg:#0a0a0a;
  --card-bdr:#1a1a1a;
  --input-bg:#1a1a1a;
  --btn-bg:#1a1a1a;
  --btn-hover:#252525;
}

:root{background-color:#ffffff}
[data-theme="dark"]{background-color:#000000}
[data-theme="dark"] html{background-color:#000000}
html,body{margin:0;padding:0;overscroll-behavior:none}
html{min-height:100%;background-color:var(--bg)}
body{min-height:100vh;font-family:'Switzer',system-ui,sans-serif;background-color:var(--bg);color:var(--txt);line-height:1.6;-webkit-font-smoothing:antialiased;transition:background-color .3s,color .3s}

/* Layout */
.wrap{max-width:900px;margin:0 auto;padding:32px 24px 120px}

/* Header */
.hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;padding-bottom:20px;border-bottom:1px solid var(--bdr)}
.hdr-l{display:flex;align-items:center;gap:14px;transition:opacity .2s;text-decoration:none;color:inherit}
.hdr-l:hover{opacity:0.8}
.logo-i{width:48px;height:48px;position:relative;flex-shrink:0}
.logo-i img{position:absolute;top:0;left:0;width:100%;height:100%}
.logo-i .logo-dark{display:none}
.logo-outer{animation:logoSpin 21s linear infinite}
@keyframes logoSpin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

/* Text Rotator */
.text-rotator{position:relative;height:48px;min-width:200px}
.text-main{position:absolute;top:0;left:0;height:48px;display:flex;align-items:center;font-size:28px;font-weight:800;line-height:1.2;letter-spacing:-0.03em;white-space:nowrap;color:var(--txt);opacity:1;transition:opacity 0.5s ease}
.text-main.hidden{opacity:0;pointer-events:none}
.text-trusted{position:absolute;top:0;left:0;height:48px;display:flex;align-items:center;gap:12px;opacity:0;transition:opacity 0.5s ease}
.text-trusted.active{opacity:1}
.trusted-prefix{font-size:15px;font-weight:500;color:var(--txt2);white-space:nowrap;flex-shrink:0}
.creator-rotator{position:relative;height:48px;overflow:hidden;-webkit-mask-image:linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);mask-image:linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%)}
.creator-rotator-inner{display:flex;flex-direction:column;transition:transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)}
.creator-row{height:48px;display:flex;align-items:center;gap:12px;flex-shrink:0}
.creator-photo{width:48px;height:48px;border-radius:50%;object-fit:cover;flex-shrink:0;box-shadow:0 2px 8px rgba(0,0,0,0.08);background:var(--bg3)}
.creator-photo[src=""],.creator-photo:not([src]){visibility:hidden}
[data-theme="dark"] .creator-photo{box-shadow:0 2px 12px rgba(0,0,0,0.25)}
.creator-name{font-size:28px;font-weight:800;letter-spacing:-0.03em;white-space:nowrap;color:var(--txt);line-height:1}
.hdr-r{display:flex;align-items:center;gap:10px}

/* Page Tabs */
.page-tabs{display:grid;grid-template-columns:1fr 1fr;gap:0;margin-bottom:12px;border-bottom:3px solid var(--bdr)}
.page-tab{padding:8px 0;background:transparent;border:0;border-bottom:3px solid transparent;margin-bottom:-3px;color:var(--txt3);font:800 28px 'Switzer',sans-serif;letter-spacing:-0.03em;cursor:pointer;transition:all .2s;text-align:left}
.page-tab:hover{color:var(--txt)}
.page-tab.on{color:var(--txt);border-bottom-color:var(--red)}
.page-tab:last-child.on{border-bottom-color:#3b82f6}

/* Theme Toggle */
.theme-toggle{width:42px;height:42px;border-radius:10px;background:transparent;border:1px solid transparent;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;transition:all .2s}
.theme-toggle:hover{background:var(--bg3);border-color:var(--bdr)}

/* Info Panel */
.info-panel{display:none}
.info-panel.open{display:block}
.calc-content{}
.calc-content.hidden{display:none}
.info-grid{display:flex;flex-direction:column;gap:12px}

/* Accordions */
.sh-acc{background:var(--card-bg);border:1px solid var(--bdr);border-radius:var(--radius);overflow:hidden;transition:all .2s}
.sh-acc:hover{border-color:var(--bdr2)}
.sh-acc-t{width:100%;display:flex;align-items:center;justify-content:space-between;padding:20px 24px;background:0;border:0;color:var(--txt);font:800 23px/1.4 'Switzer',sans-serif;letter-spacing:-0.02em;cursor:pointer;transition:background .15s;text-align:left}
.sh-acc-t:hover{background:transparent}
.sh-acc-t > span:first-child{display:flex;align-items:center}
.sh-acc-t .ico{width:22px;height:22px;margin-right:14px;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;color:var(--txt2)}
.sh-acc-t .ico svg{width:22px;height:22px;stroke-width:2.5}
.sh-acc-arr{width:8px;height:8px;border-right:2px solid var(--txt3);border-bottom:2px solid var(--txt3);transform:rotate(-45deg);transition:transform .25s ease;flex-shrink:0}
.sh-acc.open .sh-acc-arr{transform:rotate(45deg)}
.sh-acc-b{display:grid;grid-template-rows:0fr;transition:grid-template-rows .3s ease}
.sh-acc.open .sh-acc-b{grid-template-rows:1fr}
.sh-acc-inner{overflow:hidden}
.sh-acc-content{padding:4px 24px 28px;font-size:15px;color:var(--txt2);line-height:1.7}

/* Steps */
.step{display:flex;gap:14px;margin-bottom:0}
.step-l{display:flex;flex-direction:column;align-items:center}
.step-d{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:600;color:#fff;flex-shrink:0}
.step-d.bl{background:#3b82f6}.step-d.gr{background:#22c55e}
.step-c{width:1.5px;flex:1;background:var(--bdr);margin:6px 0;min-height:12px}
.step-x{padding:2px 0 20px;flex:1}
.step-x h4{font-size:15px;font-weight:600;margin-bottom:2px;color:var(--txt)}
.step-x p{font-size:15px;color:var(--txt2);line-height:1.5}
.step-x .qc{font-size:15px;color:var(--txt2);margin-top:2px}

/* Grid */
.sh-gr2{display:grid;grid-template-columns:1fr 1fr;gap:32px}
@media(max-width:500px){.sh-gr2{grid-template-columns:1fr;gap:24px}}

/* Cards */
.sh-card{background:transparent;border-radius:0;padding:0;transition:background .3s}
.sh-card h4{font-size:15px;font-weight:600;margin-bottom:12px}
.sh-card ul{list-style:none;font-size:15px}
.sh-card li{margin-bottom:6px;color:var(--txt2)}
.sh-card .fn{font-size:15px;color:var(--txt2);margin-top:16px;padding-top:16px;border-top:1px solid var(--bdr)}

/* Tabs */
.sh-tabs{display:inline-flex;background:var(--bdr);border-radius:8px;padding:3px;margin-bottom:20px;gap:2px}
.sh-tab{padding:8px 16px;background:transparent;border:0;border-radius:6px;color:var(--txt3);font:500 13px 'Switzer',sans-serif;cursor:pointer;transition:all .15s;white-space:nowrap}
.sh-tab:hover{color:var(--txt)}
.sh-tab.on{color:var(--txt);background:var(--card-bg);font-weight:600;box-shadow:0 1px 2px rgba(0,0,0,.08)}
.sh-tp{display:none}.sh-tp.on{display:block}
.sh-tr{margin-bottom:0;font-size:15px;display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--bdr)}
.sh-tr:last-child{border-bottom:none}
.sh-tr span:first-child{font-weight:600}
.sh-tr .bl{color:#3b82f6}.sh-tr .rd{color:#ef4444}

/* Table */
.sh-table{width:100%;border-collapse:collapse;font-size:15px}
.sh-table th,.sh-table td{padding:12px 0;text-align:left;border-bottom:1px solid var(--bdr)}
.sh-table th{color:var(--txt3);font-weight:500;font-size:15px;text-transform:uppercase;letter-spacing:0.5px}
.sh-table tbody tr:last-child td{border-bottom:none}
.sh-table .ctr{text-align:right}

/* FAQ */
.faq-list{display:flex;flex-direction:column;gap:0}
.sh-faq{border-bottom:1px solid var(--bdr)}
.sh-faq:last-child{border-bottom:none}
.sh-faq-q{width:100%;padding:14px 0;background:0;border:0;color:var(--txt);font:500 15px 'Switzer',sans-serif;text-align:left;cursor:pointer;transition:color .15s;display:flex;align-items:center;justify-content:space-between;gap:16px}
.sh-faq-q:hover{color:#3b82f6}
.sh-faq-q::after{content:'';width:8px;height:8px;border-right:1.5px solid var(--txt3);border-bottom:1.5px solid var(--txt3);transform:rotate(-45deg);transition:transform .2s;flex-shrink:0}
.sh-faq.open .sh-faq-q::after{transform:rotate(45deg)}
.sh-faq-a{display:none;padding:0 0 14px 0;font-size:15px;color:var(--txt2);line-height:1.6}
.sh-faq.open .sh-faq-a{display:block}

/* Hero */
.hero{margin-bottom:24px}
.hero-h{margin-bottom:24px;text-align:left}
.hero-h h2{font-size:32px;font-weight:800;letter-spacing:-0.03em;margin-bottom:8px;background:linear-gradient(135deg,var(--txt) 0%,var(--txt2) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-h p{font-size:15px;color:var(--txt2)}

/* Calculator Steps */
.cs{background:var(--card-bg);border:1px solid var(--bdr);border-radius:var(--radius);padding:var(--pad);margin-bottom:var(--gap);transition:all .2s}
.cs:hover{border-color:var(--bdr2)}
.cs.hid{display:none}
.cs-h{display:flex;align-items:center;gap:6px;margin-bottom:20px;margin-left:2px}
.cs-n{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;color:#fff;overflow:hidden;flex-shrink:0}
.cs-n.pn{background:var(--red)}
.cs-n.dn{background:transparent;margin-left:-5px;overflow:visible}
.cs-n img{width:24px;height:24px;object-fit:contain}
.cs-h h3{font-size:23px;font-weight:800;letter-spacing:-0.02em}

/* YouTube Logo Link */
.yt-logo-link{display:flex;align-items:center;justify-content:center;transition:opacity .2s, transform .2s;position:relative}
.yt-logo-link:hover{opacity:0.8;transform:scale(1.05)}
.yt-logo-link::after{content:'Open YouTube';position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%) translateY(4px);background:#ffffff !important;color:#111111 !important;padding:6px 10px;border-radius:6px;font-size:11px;font-weight:500;white-space:nowrap;opacity:0;visibility:hidden;transition:all .2s ease;pointer-events:none;z-index:9999;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.yt-logo-link::before{content:'';position:absolute;bottom:calc(100% + 2px);left:50%;transform:translateX(-50%) translateY(4px);border:5px solid transparent;border-top-color:#ffffff !important;opacity:0;visibility:hidden;transition:all .2s ease;pointer-events:none;z-index:9999}
.yt-logo-link:hover::after{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}
.yt-logo-link:hover::before{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}
[data-theme="dark"] .yt-logo-link::after{background:#ffffff !important;color:#111111 !important;box-shadow:0 2px 12px rgba(0,0,0,.4)}
[data-theme="dark"] .yt-logo-link::before{border-top-color:#ffffff !important}

/* Speaker Grid */
.spk-g{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:4px}
@media(max-width:500px){.spk-g{grid-template-columns:repeat(2,1fr)}}
.spk{padding:12px 10px;background:var(--card-bg);border:1px solid var(--bdr);border-radius:var(--radius-sm);color:var(--txt);font:600 15px 'Switzer',sans-serif;cursor:pointer;transition:all .2s;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.spk:hover{background:var(--card-bg);border-color:var(--txt3);box-shadow:0 2px 6px rgba(0,0,0,.1)}
.spk.on{background:var(--blue);color:#fff;border-color:var(--blue);box-shadow:0 2px 6px rgba(37,99,235,.3)}
.spk-hint{font-size:14px;color:var(--txt2);margin-top:10px}

/* Custom Pricing Notice */
.cust{margin-top:20px;padding:16px;background:rgba(37,99,235,.1);border:1px solid rgba(37,99,235,.3);border-radius:var(--radius-sm)}
.cust p{font-size:15px;color:#3b82f6}
.cust a{color:#3b82f6}

/* URL Input */
.url-r{display:flex;gap:12px}
@media(max-width:500px){.url-r{flex-direction:column}}
.url-i{flex:1;padding:14px 18px;background:var(--card-bg);border:1px solid var(--bdr);border-radius:var(--radius-sm);color:var(--txt);font:15px 'Switzer',sans-serif;transition:all .2s}
.url-i::placeholder{color:var(--txt3)}
.url-i:focus{outline:0;border-color:var(--blue)}
.fetch{padding:16px 32px;background:var(--red);border:1px solid var(--red);border-radius:var(--radius-sm);color:#fff;font:700 16px 'Switzer',sans-serif;cursor:pointer;white-space:nowrap;min-width:160px;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s}
.fetch:hover{background:#b91c1c;border-color:#b91c1c}
.fetch:disabled{background:transparent;cursor:not-allowed;color:var(--txt3);border:1px solid var(--bdr)}
.fetch-hint{font-size:15px;color:var(--txt2);margin-top:12px;transition:opacity .2s}
.fetch.done{background:var(--green);pointer-events:none;min-width:50px;padding:14px 16px}
.err{margin-top:14px;padding:14px;background:rgba(220,38,38,.15);border:1px solid rgba(220,38,38,.4);border-radius:6px;font-size:15px;color:#ef4444}

/* Channel Cards Container */
.channels-container{display:flex;flex-direction:column;gap:16px}

/* Channel Card */
.ch-card{background:var(--card-bg);border:1px solid var(--bdr);border-radius:var(--radius);padding:20px;position:relative;overflow:visible;transition:all .2s}
.ch-card:hover{border-color:var(--bdr2)}
.ch-card.pending-speaker{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.ch-r{display:flex;align-items:center;justify-content:space-between;gap:16px}
.ch-i{display:flex;align-items:center;gap:14px;flex:1;min-width:0}
.ch-pfp{width:48px;height:48px;border-radius:50%;object-fit:cover;flex-shrink:0;transition:opacity .2s}
.ch-pfp:hover{opacity:0.8}
.ch-info{flex:1;min-width:0}
.ch-info h3{font-size:16px;font-weight:600;color:var(--txt);margin:0 0 6px 0;line-height:1.3}
.ch-info a:hover h3{text-decoration:underline}
.ch-meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:6px}
.ch-badge{padding:4px 10px;background:var(--bg3);border-radius:6px;font-size:13px;font-weight:500;color:var(--txt2);white-space:nowrap}
.ch-badge.rate{background:rgba(37,99,235,.1);color:#3b82f6;position:relative}
.ch-badge.rate.clickable{cursor:pointer;transition:background .15s}
.ch-badge.rate.clickable:hover{background:rgba(37,99,235,.2)}
.spk-tooltip{position:absolute;top:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--card-bg);border:1px solid var(--bdr);border-radius:8px;padding:6px;display:flex;gap:4px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:100;white-space:nowrap}
.spk-tooltip::before{content:'';position:absolute;top:-6px;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top:none;border-bottom-color:var(--bdr)}
.spk-tooltip::after{content:'';position:absolute;top:-5px;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top:none;border-bottom-color:var(--card-bg)}
.spk-opt{padding:6px 12px;border:1px solid var(--bdr);border-radius:6px;background:var(--bg2);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;color:var(--txt)}
.spk-opt:hover{background:var(--bg3)}
.spk-opt.on{background:#3b82f6;color:#fff;border-color:#3b82f6}
[data-theme="dark"] .spk-tooltip{background:#1a1a1a;border-color:#333;box-shadow:0 4px 16px rgba(0,0,0,.4)}
[data-theme="dark"] .spk-tooltip::before{border-bottom-color:#333}
[data-theme="dark"] .spk-tooltip::after{border-bottom-color:#1a1a1a}
[data-theme="dark"] .spk-opt{background:#222;border-color:#444;color:#fff}
[data-theme="dark"] .spk-opt:hover{background:#333}
.ch-stats{font-size:14px;color:var(--txt2);margin:0}
.edit{padding:12px 20px;background:var(--red);border:0;border-radius:8px;color:#fff;font:600 14px 'Switzer',sans-serif;cursor:pointer;transition:background .2s;flex-shrink:0}
.edit:hover{background:#b91c1c}

/* Speaker Selection Inline */
.speaker-select{margin-top:16px;padding-top:16px;border-top:1px solid var(--bdr)}
.speaker-select h4{font-size:15px;font-weight:600;margin-bottom:12px;color:var(--txt)}
.speaker-select .spk-g{margin-bottom:0}

/* Channel Close Button */
.ch-close{position:absolute;top:-10px;left:-10px;width:24px;height:24px;background:var(--card-bg);border:1px solid var(--bdr);border-radius:50%;color:var(--txt3);font-size:16px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;z-index:1;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.ch-close:hover{background:var(--bg3);border-color:var(--bdr2);color:var(--txt);transform:scale(1.1)}
[data-theme="dark"] .ch-close{box-shadow:0 1px 4px rgba(0,0,0,0.3)}

/* Selected videos list */
.sel-list{margin-top:16px;max-height:200px;overflow-y:auto;border-top:1px solid var(--bdr);padding-top:12px}
.sel-item{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--bdr)}
.sel-item:last-child{border-bottom:0}
.sel-thumb{width:80px;height:45px;border-radius:6px;object-fit:cover;flex-shrink:0;background:var(--bg3)}
.sel-info{flex:1;min-width:0}
.sel-info h4{font-size:15px;font-weight:500;color:var(--txt);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sel-info p{font-size:15px;color:var(--txt2)}
.sel-dur{font-size:15px;font-weight:600;color:var(--txt2);flex-shrink:0}
.sel-empty{padding:20px;text-align:center;color:var(--txt2);font-size:15px}

/* Add Channel Button - subtle, appears inline with channels */
.add-channel-btn{padding:8px 14px;background:transparent;border:none;border-radius:6px;color:var(--txt3);font:500 14px 'Switzer',sans-serif;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px;align-self:flex-start}
.add-channel-btn:hover{color:var(--txt);background:var(--bg3)}
.add-channel-btn span{font-size:16px;font-weight:400}

/* Results Section */
.res{margin-bottom:var(--gap)}

/* Unified Quote Container */
.quote-unified{background:var(--card-bg);border:1px solid var(--bdr);border-radius:var(--radius);overflow:hidden}
.quote-cols{display:grid;grid-template-columns:1fr auto 1fr}
@media(max-width:700px){.quote-cols{grid-template-columns:1fr}.quote-divider{height:1px;width:100%}}
.quote-col{padding:var(--pad)}
.quote-divider{width:1px;background:var(--bdr)}
@media(max-width:700px){.quote-divider{width:100%;height:1px}}

/* Language Bar */
.lang-bar{display:flex;align-items:center;gap:20px;padding:16px 24px;background:var(--bg2);border-top:1px solid var(--bdr)}
.lang-info{display:flex;align-items:center;gap:6px}
.lang-num{font-size:24px;font-weight:700;color:var(--txt);line-height:1}
.lang-label{font-size:14px;color:var(--txt2);line-height:1}
.lang-slider{flex:1;height:6px;-webkit-appearance:none;appearance:none;background:var(--bdr);border-radius:3px;cursor:pointer}
.lang-slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;background:var(--blue);border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(37,99,235,.3)}
.lang-slider::-moz-range-thumb{width:20px;height:20px;background:var(--blue);border-radius:50%;cursor:pointer;border:none}
@media(max-width:600px){.lang-bar{flex-wrap:wrap}.lang-slider{order:3;width:100%;flex:none;margin-top:8px}}

[data-theme="dark"] .lang-slider{background:#333}
[data-theme="dark"] .lang-slider::-webkit-slider-thumb{box-shadow:0 2px 8px rgba(59,130,246,.4)}

/* Results Grid */
.quote-col h3{font-size:23px;font-weight:800;letter-spacing:-0.02em;margin-bottom:18px;display:flex;align-items:center;gap:10px}
.quote-col h3.bl{color:#3b82f6}.quote-col h3.gr{color:#22c55e}
.res-r{margin-bottom:18px}
.res-row{display:flex;justify-content:space-between;font-size:15px;margin-bottom:10px}
.res-row .lb{color:var(--txt2)}
.res-t{text-align:center;padding:18px;border-radius:var(--radius-sm)}
.res-t.bl{background:#2563eb}.res-t.gr{background:#16a34a}
.res-t .sm{font-size:11px;text-transform:uppercase;letter-spacing:1px;opacity:.85;margin-bottom:4px;color:#fff}
.res-t .bg{font-size:30px;font-weight:900;color:#fff}

/* Channel Breakdown in Results */
.channel-breakdown{margin-top:12px}
.breakdown-row{display:flex;justify-content:space-between;font-size:13px;padding:6px 0;color:var(--txt2)}
.breakdown-row span:first-child{display:flex;align-items:center;gap:8px}
.breakdown-row img{width:20px;height:20px;border-radius:50%;object-fit:cover}

/* CTA Buttons */
.cta-row{display:flex;gap:12px;margin-top:20px}
@media(max-width:500px){.cta-row{flex-direction:column}}
.email-cta{flex:1;padding:18px;background:var(--txt);border:0;border-radius:var(--radius);color:var(--bg);font:700 16px 'Switzer',sans-serif;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all .2s}
.email-cta:hover{opacity:.9}
.schedule-cta{flex:1;padding:18px;background:var(--btn-bg);border:0;border-radius:var(--radius);color:var(--txt);font:700 16px 'Switzer',sans-serif;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all .2s}
.schedule-cta:hover{background:var(--btn-hover)}

/* Languages Section */
.lngs{margin-top:24px;background:var(--card-bg);border:1px solid var(--bdr);border-radius:var(--radius);padding:24px;transition:all .2s}
.lngs:hover{border-color:var(--bdr2)}
.lngs h3{font-size:23px;font-weight:800;letter-spacing:-0.02em;margin-bottom:4px}
.lngs-g{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.lc{display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--card-bg);border:1px solid var(--bdr);border-radius:6px;font-size:15px;transition:all .2s}
@media(max-width:700px){.lngs-g{grid-template-columns:repeat(3,1fr)}}
@media(max-width:450px){.lngs-g{grid-template-columns:repeat(2,1fr)}}

/* Modals */
.emodal{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(8px);z-index:999998;display:none;align-items:center;justify-content:center;padding:20px}
.emodal.open{display:flex}
.em-box{background:var(--card-bg);border:1px solid var(--card-bdr);border-radius:18px;width:100%;max-width:480px;max-height:90vh;overflow:auto;transition:all .3s}
.em-h{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--bdr)}
.em-h h3{font-size:18px;font-weight:700}
.em-x{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:0;border:0;color:var(--txt2);font-size:24px;cursor:pointer;border-radius:6px;transition:all .2s}
.em-x:hover{background:var(--bg3);color:var(--txt)}
.em-body{padding:24px}
.q-sum{background:var(--bg3);border-radius:var(--radius-sm);padding:18px;margin-bottom:20px}
.q-sum h4{font-size:16px;font-weight:600;margin-bottom:14px}
.q-nums{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.q-n .lb{font-size:15px;color:var(--txt2);margin-bottom:4px}
.q-n .vl{font-size:22px;font-weight:700}
.q-n .vl.bl{color:#3b82f6}.q-n .vl.gr{color:#22c55e}
.q-det{font-size:15px;color:var(--txt2);margin-top:14px;padding-top:14px;border-top:1px solid var(--bdr)}
.em-i{width:100%;padding:14px 18px;background:var(--input-bg);border:1px solid var(--bdr);border-radius:var(--radius-sm);color:var(--txt);font:14px 'Switzer',sans-serif;margin-bottom:16px;transition:all .2s}
.em-i::placeholder{color:var(--txt3)}
.em-i:focus{outline:0;border-color:var(--blue)}
.send{width:100%;padding:14px;background:var(--red);border:0;border-radius:var(--radius-sm);color:#fff;font:700 15px 'Switzer',sans-serif;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:background .2s}
.send:hover{background:var(--red2)}
.em-note{font-size:15px;color:var(--txt2);text-align:center;margin-top:14px}
.succ{text-align:center;padding:40px 20px}
.succ-i{width:72px;height:72px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:36px;margin:0 auto 20px;color:#fff}
.succ h3{font-size:22px;font-weight:700;margin-bottom:8px}
.succ p{color:var(--txt2)}

/* Loading */
.load{position:fixed;inset:0;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);z-index:2000;display:none;align-items:center;justify-content:center;flex-direction:column}
[data-theme="dark"] .load{background:rgba(0,0,0,.95)}
.load.open{display:flex}
.load-logo{width:72px;height:72px;position:relative;margin-bottom:24px}
.load-logo img{position:absolute;top:0;left:0;width:100%;height:100%}
.load-logo .logo-dark{display:none}
[data-theme="dark"] .load-logo img:not(.logo-dark){display:none}
[data-theme="dark"] .load-logo .logo-dark{display:block}
.load-logo .load-outer{animation:logoSpin 4s linear infinite}
.load-b{text-align:center}
.load-b p{font-weight:600;font-size:15px;color:var(--txt);margin-bottom:6px}
.load-b .sub{font-size:15px;color:var(--txt2);font-weight:400}
.load-progress{width:200px;height:3px;background:var(--bdr);border-radius:2px;margin-top:20px;overflow:hidden}
.load-progress-bar{height:100%;width:0;background:var(--red);border-radius:2px;transition:width 0.3s ease}

/* Toast */
.toast-container{position:fixed;bottom:24px;left:24px;z-index:10000;display:flex;flex-direction:column-reverse;gap:10px}
.toast{background:var(--card-bg);border:1px solid var(--card-bdr);border-radius:12px;padding:16px 20px;min-width:320px;max-width:400px;box-shadow:0 10px 40px rgba(0,0,0,.15);transform:translateX(-120%);opacity:0;transition:all .3s cubic-bezier(.22,.68,0,1.1);position:relative}
[data-theme="dark"] .toast{box-shadow:0 10px 40px rgba(0,0,0,.5)}
[data-theme="dark"] .fetch:disabled{background:transparent;color:var(--txt3);border:1px solid var(--bdr)}
[data-theme="dark"] .spk{box-shadow:0 1px 3px rgba(0,0,0,.2)}
[data-theme="dark"] .spk:hover{box-shadow:0 2px 6px rgba(0,0,0,.3)}
.toast.show{transform:translateX(0);opacity:1}
.toast.hide{transform:translateX(-120%);opacity:0}
.toast-content{display:flex;align-items:center;gap:14px}
.toast-icon{width:40px;height:40px;border-radius:50%;overflow:hidden;flex-shrink:0}
.toast-icon img{width:100%;height:100%;object-fit:cover}
.toast-text h4{font-size:15px;font-weight:600;margin-bottom:2px}
.toast-text p{font-size:15px;color:var(--txt2)}

/* Highlight Animation */
@keyframes highlightPulse{
  0%{box-shadow:0 0 0 0 rgba(34,197,94,.4)}
  70%{box-shadow:0 0 0 10px rgba(34,197,94,0)}
  100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}
}
.ch-card.highlight{animation:highlightPulse .6s ease-out;border-color:var(--green)}

.hid{display:none!important}

/* Icon colors for dark mode */
[data-theme="dark"] .sh-acc-t .ico svg{stroke:var(--txt2)}

/* Dark mode logo */
[data-theme="dark"] .logo-i .logo-outer:not(.logo-dark),
[data-theme="dark"] .logo-i .logo-inner:not(.logo-dark){display:none}
[data-theme="dark"] .logo-i .logo-dark{display:block}

/* Page Loader */
.page-loader{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;align-items:center;justify-content:center;transition:opacity .4s ease,visibility .4s ease}
.page-loader.fade-out{opacity:0;visibility:hidden}
.page-loader .load-logo{opacity:0;animation:logoFadeIn 0.3s ease 0.1s forwards}
@keyframes logoFadeIn{to{opacity:1}}
</style>
</head>
<body>

<!-- Page Loader -->
<div class="page-loader" id="pageLoader">
  <div class="load-logo">
    <img class="load-outer" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/OUTER.svg?alt=media&token=394d9498-5f0e-4e25-8ee3-9e2a3b627520" alt="">
    <img class="load-outer logo-dark" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/OUTER%20WHITE.svg?alt=media&token=9900ca7a-36ae-4e67-88e7-d7d776f12513" alt="">
    <img class="load-inner" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/INNER.svg?alt=media&token=fe5271b9-275b-4e10-aad8-6888b197abc9" alt="">
    <img class="load-inner logo-dark" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/INNER%20WHITE.svg?alt=media&token=a7f525a7-034e-4477-90c4-5e0c71cf6044" alt="">
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toasts"></div>

<div class="wrap" style="padding-bottom:0">
  <header class="hdr">
    <a href="https://humanvoiceover.com" target="_blank" rel="noopener noreferrer" class="hdr-l">
      <div class="logo-i">
        <img class="logo-outer" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/OUTER.svg?alt=media&token=394d9498-5f0e-4e25-8ee3-9e2a3b627520" alt="">
        <img class="logo-outer logo-dark" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/OUTER%20WHITE.svg?alt=media&token=9900ca7a-36ae-4e67-88e7-d7d776f12513" alt="">
        <img class="logo-inner" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/INNER.svg?alt=media&token=fe5271b9-275b-4e10-aad8-6888b197abc9" alt="">
        <img class="logo-inner logo-dark" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/INNER%20WHITE.svg?alt=media&token=a7f525a7-034e-4477-90c4-5e0c71cf6044" alt="">
      </div>
      <div class="text-rotator" id="textRotator">
        <div class="text-main" id="textMain">Human Voice Over</div>
        <div class="text-trusted" id="textTrusted">
          <span class="trusted-prefix">Trusted by</span>
          <div class="creator-rotator">
            <div class="creator-rotator-inner" id="creatorInner">
              <div class="creator-row">
                <img class="creator-photo" src="https://cdn.prod.website-files.com/67a4f537f968bfd7fc55777f/67a9e562fe1fc193869f924b_Dude%20Perfect.jpg" alt="Dude Perfect" loading="lazy">
                <span class="creator-name">Dude Perfect</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://cdn.prod.website-files.com/67a4f537f968bfd7fc55777f/67d43ffca9488a013264e984_Preston_-_Icon_-_Profile.webp" alt="Preston" loading="lazy">
                <span class="creator-name">Preston</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://cdn.prod.website-files.com/67a4f537f968bfd7fc55777f/67c5c8d909ad3c2abe261949_Jesser.webp" alt="Jesser" loading="lazy">
                <span class="creator-name">Jesser</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://cdn.prod.website-files.com/67a4f537f968bfd7fc55777f/691e1bc29b29d61546bb6169_channels4_profile%20(2).jpg" alt="Nick DiGiovanni" loading="lazy">
                <span class="creator-name">Nick DiGiovanni</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/d7beddc4-d977-450f-bc62-2fcd4f2d28f4_86d13fc0-8261-4cd9-bb8b-9fb6fbb4ccf0.png?alt=media&token=1e59250e-e3d3-4ba5-ba85-4d085d85cb59" alt="Brianna" loading="lazy">
                <span class="creator-name">Brianna</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://cdn.prod.website-files.com/67a4f537f968bfd7fc55777f/67c048949dc9061cc7b92b92_RyTr.webp" alt="Ryan Trahan" loading="lazy">
                <span class="creator-name">Ryan Trahan</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://cdn.prod.website-files.com/67a4f537f968bfd7fc55777f/67d04128ae9dc46c81201d7e_Airrack.jpg" alt="Airrack" loading="lazy">
                <span class="creator-name">Airrack</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://yt3.googleusercontent.com/HFfZisaVh7x0A_ZxfEObPrpAyDPqsuIJD0P4zE23jNL65Pdn58ixh7GsDaJcGw5797VChzybXQ=s160-c-k-c0x00ffffff-no-rj" alt="First We Feast" loading="lazy">
                <span class="creator-name">First We Feast</span>
              </div>
              <div class="creator-row">
                <img class="creator-photo" src="https://yt3.googleusercontent.com/RdjombbmvvGQGTokXHgVRF7qijHDLcnXs7h4S6N0oOua-veEap9RO7htFE30v7xnWDM1GUlCmI4=s160-c-k-c0x00ffffff-no-rj" alt="Cleo Abram" loading="lazy">
                <span class="creator-name">Cleo Abram</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </a>
    <div class="hdr-r">
      <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle theme" aria-label="Toggle dark/light theme">ðŸŒ™</button>
    </div>
  </header>
</div>

<!-- MAIN CONTENT -->
<div class="wrap" style="padding-top:0">

  <!-- HERO CALCULATOR -->
  <section class="hero">
    <div class="hero-h">
      <div class="page-tabs">
        <button class="page-tab on" id="tabCalc" onclick="showCalc()">Dubbing Calculator</button>
        <button class="page-tab" id="tabInfo" onclick="showInfo()">Info Deck</button>
      </div>
      <p id="heroSub">Get your channel's total length and average monthly output.</p>
    </div>

    <!-- Calculator Content -->
    <div class="calc-content" id="calcContent">
      
      <!-- URL Input Section -->
      <div class="cs" id="urlSection">
        <div class="cs-h">
          <div class="cs-n dn">
            <a href="https://youtube.com" target="_blank" rel="noopener noreferrer" class="yt-logo-link">
              <img src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/Youtube_logo.png?alt=media&token=dd249228-2934-4bf2-9353-952db98a3dd1" alt="YouTube">
            </a>
          </div>
          <h3>Paste YouTube Channel Link</h3>
        </div>
        <div class="url-r">
          <input type="text" class="url-i" id="urlInput" value="https://youtube.com/@" placeholder="YourChannel" onpaste="handlePaste(event)" onkeydown="handleUrlKeydown(event)" aria-label="YouTube channel URL">
          <button class="fetch" id="fetchBtn" onclick="fetchChannel()">Fetch Videos</button>
        </div>
        <div class="err hid" id="errMsg"></div>
      </div>

      <!-- Results Section (appears above channels when visible) -->
      <div class="res hid" id="resultsSection">
        <div class="quote-unified hid" id="quoteSection">
          <div class="quote-cols">
            <div class="quote-col">
              <h3 class="bl">ðŸ“¦ Backlog Cost</h3>
              <div class="res-r">
                <div class="res-row"><span class="lb">Videos Selected</span><span id="resVideos">0</span></div>
                <div class="res-row"><span class="lb">Source Minutes</span><span id="resSourceMins">0</span></div>
                <div class="res-row"><span class="lb">Blended Rate</span><span>$<span id="resRate">45</span>/min</span></div>
                <div class="res-row"><span class="lb">Ã— <span id="resLangBack">1</span> Languages</span><span><span id="resDubbedMins">0</span> min dubbed</span></div>
              </div>
              <div class="res-t bl">
                <div class="sm">Total Backlog</div>
                <div class="bg" id="resBacklogCost">$0</div>
              </div>
              <div class="channel-breakdown" id="backlogBreakdown"></div>
            </div>
            <div class="quote-divider"></div>
            <div class="quote-col">
              <h3 class="gr">ðŸ“ˆ Estimated Monthly Output</h3>
              <div class="res-r">
                <div class="res-row"><span class="lb">Total Videos</span><span id="resTotalVideos">0</span></div>
                <div class="res-row"><span class="lb">Avg Video Length</span><span><span id="resAvgLength">0</span> min</span></div>
                <div class="res-row"><span class="lb">Avg Monthly Output</span><span><span id="resMonthlyMins">0</span> min</span></div>
                <div class="res-row"><span class="lb">Ã— <span id="resLangMonth">1</span> Languages</span><span><span id="resMonthlyDubbed">0</span> min/mo</span></div>
              </div>
              <div class="res-t gr">
                <div class="sm">Est. Monthly</div>
                <div class="bg" id="resMonthlyCost">$0/mo</div>
              </div>
              <div class="channel-breakdown" id="monthlyBreakdown"></div>
            </div>
          </div>
          <div class="lang-bar">
            <div class="lang-info">
              <span class="lang-num" id="langNum">1</span>
              <span class="lang-label">Language</span>
            </div>
            <input type="range" class="lang-slider" id="langSlider" min="1" max="20" value="1" oninput="updateLangFromSlider(this.value)">
          </div>
        </div>
        
        <div class="cta-row hid" id="ctaRow">
          <button class="email-cta" onclick="openEmailModal()">ðŸ“§ Email Me This Quote</button>
          <button class="schedule-cta" onclick="openScheduleModal()">ðŸ“… Schedule a Call</button>
        </div>
      </div>

      <!-- Channels Container (includes add button) -->
      <div class="channels-container" id="channelsContainer">
        <!-- Add Channel Button rendered here when needed -->
      </div>
    </div>
    <!-- End calc-content -->

    <!-- Info Panel Content -->
    <div class="info-panel" id="infoPanel">
      <div class="info-grid">
        <!-- How It Works -->
        <div class="sh-acc" id="sha1">
          <button class="sh-acc-t" onclick="shTgl('sha1')">
            <span><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></span>How It Works</span>
            <span class="sh-acc-arr"></span>
          </button>
          <div class="sh-acc-b"><div class="sh-acc-inner"><div class="sh-acc-content">
            <div class="step"><div class="step-l"><div class="step-d bl">1</div><div class="step-c"></div></div><div class="step-x"><h4>Submit</h4><p>Upload your video. A live dashboard tracks every language in real time.</p></div></div>
            <div class="step"><div class="step-l"><div class="step-d bl">2</div><div class="step-c"></div></div><div class="step-x"><h4>Transcribe</h4><p>Accurate English script with speaker labels + time codes.</p></div></div>
            <div class="step"><div class="step-l"><div class="step-d bl">3</div><div class="step-c"></div></div><div class="step-x"><h4>Translate</h4><p>Native translators adapt line-by-line to sync perfectly.</p><div class="qc">(QC check)</div></div></div>
            <div class="step"><div class="step-l"><div class="step-d bl">4</div><div class="step-c"></div></div><div class="step-x"><h4>Record</h4><p>Pro voice actors dub while watching the video to match energy + timing.</p><div class="qc">(QC check)</div></div></div>
            <div class="step"><div class="step-l"><div class="step-d bl">5</div><div class="step-c"></div></div><div class="step-x"><h4>Sound Engineer</h4><p>Mix + master so voices blend seamlessly with music + effects.</p><div class="qc">(QC check)</div></div></div>
            <div class="step"><div class="step-l"><div class="step-d gr">6</div></div><div class="step-x"><h4 style="color:#22c55e">We Deliver</h4><p>Final dubs, quality-checked and organized, ready to publish.</p><div class="qc">(3rd-party QC)</div></div></div>
          </div></div></div>
        </div>

        <!-- Multi-Language Audio -->
        <div class="sh-acc" id="sha2">
          <button class="sh-acc-t" onclick="shTgl('sha2')">
            <span><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg></span>Multi-Language Audio (MLA)</span>
            <span class="sh-acc-arr"></span>
          </button>
          <div class="sh-acc-b"><div class="sh-acc-inner"><div class="sh-acc-content">
            <p style="font-size:15px;color:var(--txt2);margin-bottom:20px">HVO exclusively works with creators using YouTube's Multi-Language Audio feature instead of separate language channels.</p>
            <h4 style="font-weight:600;margin-bottom:14px;font-size:15px;text-transform:uppercase;letter-spacing:0.5px;color:var(--txt3)">Why MLA Only?</h4>
            <div style="font-size:15px;color:var(--txt2);line-height:2">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>All languages consolidated on your main channel</div>
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>International views boost your primary channel's growth</div>
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>Single upload workflow â€” publish all languages at once</div>
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>Existing subscribers unaffected by new audio tracks</div>
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>No channel management overhead for you or us</div>
              <div style="display:flex;align-items:center;gap:8px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>YouTube's algorithm favors MLA-enabled content</div>
            </div>
            <p style="font-size:15px;color:var(--txt2);margin-top:20px;padding-top:16px;border-top:1px solid var(--bdr)">Requires 40-50 uploads with audio tracks to unlock the MLA feature on YouTube.</p>
          </div></div></div>
        </div>

        <!-- Turnaround Speeds -->
        <div class="sh-acc" id="sha3">
          <button class="sh-acc-t" onclick="shTgl('sha3')">
            <span><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></span>Turnaround Speeds</span>
            <span class="sh-acc-arr"></span>
          </button>
          <div class="sh-acc-b"><div class="sh-acc-inner"><div class="sh-acc-content">
            <p style="color:#22c55e;font-size:15px;margin-bottom:24px;display:flex;align-items:center;gap:6px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>Flexible and can be adjusted to fit your upload schedule.</p>
            
            <div style="margin-bottom:28px">
              <h4 style="font-weight:600;margin-bottom:16px;font-size:15px;text-transform:uppercase;letter-spacing:0.5px;color:var(--txt3)">Ongoing Videos</h4>
              <div class="sh-tabs"><button class="sh-tab on" onclick="shTab(event,'sht1')">Up to 30 Min</button><button class="sh-tab" onclick="shTab(event,'sht2')">60 Min</button><button class="sh-tab" onclick="shTab(event,'sht3')">90 Min</button></div>
              <div id="sht1" class="sh-tp on"><div class="sh-tr"><span class="bl">Standard</span><span>~7 Days</span></div><div class="sh-tr"><span class="rd">Expedited</span><span>~5 Days</span></div></div>
              <div id="sht2" class="sh-tp"><div class="sh-tr"><span class="bl">Standard</span><span>~10 Days</span></div><div class="sh-tr"><span class="rd">Expedited</span><span>~7 Days</span></div></div>
              <div id="sht3" class="sh-tp"><div class="sh-tr"><span class="bl">Standard</span><span>~14 Days</span></div><div class="sh-tr"><span class="rd">Expedited</span><span>~10 Days</span></div></div>
            </div>
            
            <div style="margin-bottom:28px">
              <h4 style="font-weight:600;margin-bottom:16px;font-size:15px;text-transform:uppercase;letter-spacing:0.5px;color:var(--txt3)">Back Catalog <span style="font-weight:400;text-transform:none;letter-spacing:0">(200-400 min)</span></h4>
              <div class="sh-tr"><span class="bl">Standard</span><span>Monthly Delivery</span></div><div class="sh-tr"><span class="rd">Expedited</span><span>Weekly Delivery</span></div>
            </div>
            
            <div>
              <h4 style="font-weight:600;margin-bottom:12px;font-size:15px;text-transform:uppercase;letter-spacing:0.5px;color:var(--txt3)">YouTube Shorts</h4>
              <p style="font-size:15px;color:var(--txt2)">Our studios require a 10-15 minute minimum. Send 10-15 shorts together.</p>
            </div>
          </div></div></div>
        </div>

        <!-- Pricing Structure -->
        <div class="sh-acc" id="sha4">
          <button class="sh-acc-t" onclick="shTgl('sha4')">
            <span><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></span>Pricing Structure</span>
            <span class="sh-acc-arr"></span>
          </button>
          <div class="sh-acc-b"><div class="sh-acc-inner"><div class="sh-acc-content">
            <table class="sh-table"><thead><tr><th>Recurring Speakers</th><th class="ctr">Per Minute</th></tr></thead>
            <tbody><tr><td>1-2 voices</td><td class="ctr" style="font-weight:600">$45/min</td></tr>
            <tr><td>3-4 voices</td><td class="ctr" style="font-weight:600">$50/min</td></tr>
            <tr><td>5-6 voices</td><td class="ctr" style="font-weight:600">$55/min</td></tr>
            <tr><td>7+ voices</td><td class="ctr" style="color:var(--txt3)">Custom</td></tr></tbody></table>
            <p style="font-size:15px;color:var(--txt2);margin-top:16px">Per minute, per language. Expedited +$5/min.</p>
          </div></div></div>
        </div>

        <!-- Submitting & Receiving -->
        <div class="sh-acc" id="sha5">
          <button class="sh-acc-t" onclick="shTgl('sha5')">
            <span><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg></span>Submitting & Receiving Dubs</span>
            <span class="sh-acc-arr"></span>
          </button>
          <div class="sh-acc-b"><div class="sh-acc-inner"><div class="sh-acc-content">
            <div class="sh-gr2">
              <div><h4 style="font-weight:600;margin-bottom:14px;font-size:15px;text-transform:uppercase;letter-spacing:0.5px;color:var(--txt3)">What We Need</h4><ol style="list-style:decimal;padding-left:18px;font-size:15px;color:var(--txt2);line-height:2"><li>Video Length</li><li>Release Date</li><li>Titles</li><li>Description</li><li>Video URL</li><li>Background Audio URL</li><li>Notes</li></ol></div>
              <div><h4 style="font-weight:600;margin-bottom:14px;font-size:15px;text-transform:uppercase;letter-spacing:0.5px;color:var(--txt3)">What You Get</h4><ol style="list-style:decimal;padding-left:18px;font-size:15px;color:var(--txt2);line-height:2"><li>Translated Titles (SEO)</li><li>Translated Description</li><li>Translated Thumbnail Text</li><li>Dubbed Mixed Audio (.WAV)</li><li>Dubbed Raw Audio (.WAV)</li><li>Translated Subtitles (.SRT)</li><li>English Transcript (.SRT)</li></ol></div>
            </div>
          </div></div></div>
        </div>

        <!-- FAQ -->
        <div class="sh-acc" id="sha6">
          <button class="sh-acc-t" onclick="shTgl('sha6')">
            <span><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>F.A.Q</span>
            <span class="sh-acc-arr"></span>
          </button>
          <div class="sh-acc-b"><div class="sh-acc-inner"><div class="sh-acc-content"><div class="faq-list" id="shfaq"></div></div></div></div>
        </div>
      </div>
    </div>
  </section>

  <section class="lngs hid" id="lngsSection"><h3>Top 20 Languages</h3><p style="font-size:15px;color:var(--txt2);margin-bottom:18px">(Highest Ticket to Lowest)</p><div class="lngs-g" id="lngsg"></div><p style="font-size:15px;color:var(--txt2);margin-top:16px;text-align:left">and 30+ more languages â€” just ask!</p></section>
</div>

<!-- VIDEO MODAL HOST -->
<div id="video-modal-host"></div>

<!-- EMAIL MODAL -->
<div class="emodal" id="emailModal" onclick="closeModalOut(event, 'emailModal')">
  <div class="em-box" onclick="event.stopPropagation()">
    <div class="em-h"><h3>Email Your Quote</h3><button class="em-x" onclick="closeModal('emailModal')">Ã—</button></div>
    <div class="em-body" id="emailForm">
      <div class="q-sum">
        <h4 id="emailChannels">Channel</h4>
        <div class="q-nums">
          <div class="q-n"><div class="lb">Backlog</div><div class="vl bl" id="emailBacklog">$0</div></div>
          <div class="q-n"><div class="lb">Monthly Ongoing</div><div class="vl gr" id="emailMonthly">$0/mo</div></div>
        </div>
        <div class="q-det" id="emailDetails"></div>
      </div>
      <input type="email" class="em-i" id="emailInput" placeholder="you@company.com">
      <button class="send" onclick="sendQuote()">ðŸ“§ Send Quote</button>
      <p class="em-note">We'll email you a summary to share with your team</p>
    </div>
    <div class="em-body hid" id="emailSuccess">
      <div class="succ"><div class="succ-i">âœ“</div><h3>Quote Sent!</h3><p>Check your inbox for your personalized quote.</p></div>
    </div>
  </div>
</div>

<!-- SCHEDULE MODAL -->
<div class="emodal" id="scheduleModal" onclick="closeModalOut(event, 'scheduleModal')">
  <div class="em-box" onclick="event.stopPropagation()">
    <div class="em-h"><h3>Schedule a Call</h3><button class="em-x" onclick="closeModal('scheduleModal')">Ã—</button></div>
    <div class="em-body" id="scheduleForm">
      <div class="q-sum">
        <h4 id="scheduleChannels">Channel</h4>
        <div class="q-nums">
          <div class="q-n"><div class="lb">Backlog</div><div class="vl bl" id="scheduleBacklog">$0</div></div>
          <div class="q-n"><div class="lb">Monthly Ongoing</div><div class="vl gr" id="scheduleMonthly">$0/mo</div></div>
        </div>
        <div class="q-det" id="scheduleDetails"></div>
      </div>
      <input type="email" class="em-i" id="scheduleEmailInput" placeholder="you@company.com">
      <button class="send" onclick="submitSchedule()">ðŸ“… Continue to Scheduling</button>
      <p class="em-note">We'll save your quote and open our calendar</p>
    </div>
    <div class="em-body hid" id="scheduleSuccess">
      <div class="succ"><div class="succ-i">âœ“</div><h3>Opening Calendar...</h3><p>Your quote has been saved.</p></div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div class="load" id="loadingOverlay">
  <div class="load-logo">
    <img class="load-outer" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/OUTER.svg?alt=media&token=394d9498-5f0e-4e25-8ee3-9e2a3b627520" alt="">
    <img class="load-outer logo-dark" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/OUTER%20WHITE.svg?alt=media&token=9900ca7a-36ae-4e67-88e7-d7d776f12513" alt="">
    <img class="load-inner" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/INNER.svg?alt=media&token=fe5271b9-275b-4e10-aad8-6888b197abc9" alt="">
    <img class="load-inner logo-dark" src="https://firebasestorage.googleapis.com/v0/b/human-voice-over-prod.firebasestorage.app/o/INNER%20WHITE.svg?alt=media&token=a7f525a7-034e-4477-90c4-5e0c71cf6044" alt="">
  </div>
  <div class="load-b">
    <p>Fetching channel videos...</p>
  </div>
  <div class="load-progress"><div class="load-progress-bar" id="loadProgress"></div></div>
</div>

<script>
// =====================
// CONSTANTS
// =====================
const PRICING = { '1-2': 45, '3-4': 50, '5-6': 55 };
const TIERS = ['1-2', '3-4', '5-6', '7+'];
const LANGUAGES = [
  ['ðŸ‡©ðŸ‡ª','German'],['ðŸ‡®ðŸ‡¹','Italian'],['ðŸ‡«ðŸ‡·','French'],['ðŸ‡¯ðŸ‡µ','Japanese'],['ðŸ‡°ðŸ‡·','Korean'],
  ['ðŸ‡²ðŸ‡½','Spanish'],['ðŸ‡·ðŸ‡º','Russian'],['ðŸ‡¹ðŸ‡·','Turkish'],['ðŸ‡§ðŸ‡·','Portuguese'],['ðŸ‡¸ðŸ‡¦','Arabic'],
  ['ðŸ‡¹ðŸ‡­','Thai'],['ðŸ‡»ðŸ‡³','Vietnamese'],['ðŸ‡®ðŸ‡³','Hindi'],['ðŸ‡®ðŸ‡©','Indonesian'],['ðŸ‡§ðŸ‡©','Bangla'],
  ['ðŸ‡®ðŸ‡³','Punjabi'],['ðŸ‡µðŸ‡°','Urdu'],['ðŸ‡µðŸ‡±','Polish'],['ðŸ‡®ðŸ‡³','Tamil'],['ðŸ‡³ðŸ‡±','Dutch']
];
const FAQS = [
  ["What's a casting?","Before moving forward we will prepare a few voice options for you to confirm in a short clip of your material."],
  ["What languages do you offer?","Albanian, Arabic, Bengali, Chinese, Dutch, French, German, Hindi, Indonesian, Italian, Japanese, Korean, Polish, Portuguese, Russian, Spanish, Thai, Turkish, Vietnamese + more"],
  ["How does ongoing billing work?","We bill you at the end of each month based on your total minute usage per language."],
  ["Will my voice actor stay the same?","Yes, we use the same voice actor(s) for all main recurring speakers."],
  ["Does HVO collect a rev-share?","No"],
  ["Who owns the rights to delivered dubs?","You do. We guarantee the transfer of all ownership rights indefinitely."],
  ["How many studios?","60 locations"],
  ["How many actors?","Around 200 per studio and 500 remote actors"],
  ["How many translators?","600 on hand + 400 extra if needed"],
  ["How many audio engineers?","30 in-house engineers"]
];

// =====================
// STATE
// =====================
let state = {
  channels: [],
  languages: 1,
  pendingUrl: '',
  currentChannelId: null
};

let channelIdCounter = 0;

// Shadow DOM references
let shadowRoot, shadowModal, shadowVgrid;

// =====================
// INITIALIZATION
// =====================
document.addEventListener('DOMContentLoaded', () => {
  initTheme();
  createShadowModal();
  initTextRotator();
  renderFAQs();
  renderLanguages();
  
  // Fade out page loader
  setTimeout(() => {
    const pl = document.getElementById('pageLoader');
    if (pl) {
      pl.classList.add('fade-out');
      setTimeout(() => pl.remove(), 400);
    }
  }, 1300);
});

// =====================
// THEME
// =====================
function initTheme() {
  const saved = localStorage.getItem('theme');
  const btn = document.getElementById('themeToggle');
  if (saved === 'dark') {
    btn.textContent = 'â˜€ï¸';
  }
}

function toggleTheme() {
  const html = document.documentElement;
  const btn = document.getElementById('themeToggle');
  const metaTheme = document.getElementById('metaThemeColor');
  const isDark = html.getAttribute('data-theme') === 'dark';
  
  if (isDark) {
    html.removeAttribute('data-theme');
    html.style.backgroundColor = '';
    btn.textContent = 'ðŸŒ™';
    localStorage.setItem('theme', 'light');
    if (metaTheme) metaTheme.content = '#ffffff';
  } else {
    html.setAttribute('data-theme', 'dark');
    html.style.backgroundColor = '#000000';
    btn.textContent = 'â˜€ï¸';
    localStorage.setItem('theme', 'dark');
    if (metaTheme) metaTheme.content = '#000000';
  }
  updateShadowTheme();
}

function updateShadowTheme() {
  if (!shadowRoot) return;
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  const modal = shadowRoot.querySelector('.modal-overlay');
  if (modal) modal.setAttribute('data-theme', isDark ? 'dark' : '');
}

// =====================
// TEXT ROTATOR
// =====================
const NUM_CREATORS = 9;
const MAIN_DURATION = 5000;
const CREATOR_DURATION = 2500;
let currentCreatorIndex = 0;
let isShowingMain = true;
let rotatorTimeout = null;

function initTextRotator() {
  if (rotatorTimeout) clearTimeout(rotatorTimeout);
  isShowingMain = true;
  currentCreatorIndex = 0;
  
  const inner = document.getElementById('creatorInner');
  if (!inner) return;
  inner.style.transition = 'none';
  inner.style.transform = 'translateY(0)';
  
  rotatorTimeout = setTimeout(() => switchToCreators(), MAIN_DURATION);
}

function switchToCreators() {
  if (rotatorTimeout) clearTimeout(rotatorTimeout);
  isShowingMain = false;
  currentCreatorIndex = 0;
  
  const textMain = document.getElementById('textMain');
  const textTrusted = document.getElementById('textTrusted');
  if (textMain) textMain.classList.add('hidden');
  if (textTrusted) textTrusted.classList.add('active');
  
  const inner = document.getElementById('creatorInner');
  if (!inner) return;
  inner.style.transition = 'none';
  inner.style.transform = 'translateY(0)';
  
  requestAnimationFrame(() => {
    inner.style.transition = 'transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)';
  });
  
  scheduleNextCreator();
}

function switchToMain() {
  if (rotatorTimeout) clearTimeout(rotatorTimeout);
  isShowingMain = true;
  
  const textMain = document.getElementById('textMain');
  const textTrusted = document.getElementById('textTrusted');
  if (textMain) textMain.classList.remove('hidden');
  if (textTrusted) textTrusted.classList.remove('active');
  
  rotatorTimeout = setTimeout(() => switchToCreators(), MAIN_DURATION);
}

function scheduleNextCreator() {
  rotatorTimeout = setTimeout(() => {
    currentCreatorIndex++;
    if (currentCreatorIndex >= NUM_CREATORS) {
      switchToMain();
    } else {
      const inner = document.getElementById('creatorInner');
      if (inner) inner.style.transform = `translateY(${-currentCreatorIndex * 48}px)`;
      scheduleNextCreator();
    }
  }, CREATOR_DURATION);
}

// =====================
// TAB SWITCHING
// =====================
function showCalc() {
  document.getElementById('infoPanel').classList.remove('open');
  document.getElementById('calcContent').classList.remove('hidden');
  document.getElementById('tabCalc').classList.add('on');
  document.getElementById('tabInfo').classList.remove('on');
  document.getElementById('heroSub').textContent = 'Get your channel\'s total length and average monthly output.';
  document.getElementById('lngsSection').classList.add('hid');
}

function showInfo() {
  document.getElementById('infoPanel').classList.add('open');
  document.getElementById('calcContent').classList.add('hidden');
  document.getElementById('tabCalc').classList.remove('on');
  document.getElementById('tabInfo').classList.add('on');
  document.getElementById('heroSub').textContent = 'Learn about our dubbing process and pricing';
  document.getElementById('lngsSection').classList.remove('hid');
}

// =====================
// ACCORDIONS & TABS
// =====================
function shTgl(id) {
  const allAccs = document.querySelectorAll('.sh-acc');
  const clickedAcc = document.getElementById(id);
  const isOpen = clickedAcc.classList.contains('open');
  allAccs.forEach(acc => acc.classList.remove('open'));
  if (!isOpen) clickedAcc.classList.add('open');
}

function shTab(e, id) {
  e.target.parentElement.querySelectorAll('.sh-tab').forEach(t => t.classList.remove('on'));
  e.target.classList.add('on');
  e.target.parentElement.parentElement.querySelectorAll('.sh-tp').forEach(p => p.classList.remove('on'));
  document.getElementById(id).classList.add('on');
}

// =====================
// RENDER STATIC CONTENT
// =====================
function renderFAQs() {
  const container = document.getElementById('shfaq');
  FAQS.forEach(f => {
    const d = document.createElement('div');
    d.className = 'sh-faq';
    d.innerHTML = `<button class="sh-faq-q" onclick="this.parentElement.classList.toggle('open')">${f[0]}</button><div class="sh-faq-a">${f[1]}</div>`;
    container.appendChild(d);
  });
}

function renderLanguages() {
  const container = document.getElementById('lngsg');
  LANGUAGES.forEach(l => {
    const d = document.createElement('div');
    d.className = 'lc';
    d.innerHTML = `<span>${l[0]}</span><span>${l[1]}</span>`;
    container.appendChild(d);
  });
}

// =====================
// TOAST SYSTEM
// =====================
function showToast(opts) {
  const container = document.getElementById('toasts');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `
    <div class="toast-content">
      <div class="toast-icon"><img src="${opts.image}" alt=""></div>
      <div class="toast-text"><h4>${opts.title}</h4><p>${opts.description}</p></div>
    </div>
  `;
  container.appendChild(toast);
  requestAnimationFrame(() => toast.classList.add('show'));
  setTimeout(() => {
    toast.classList.remove('show');
    toast.classList.add('hide');
    setTimeout(() => toast.remove(), 300);
  }, opts.duration || 4000);
}

// =====================
// URL INPUT & FETCH
// =====================
function handlePaste(e) {
  const pasted = (e.clipboardData || window.clipboardData).getData('text');
  if (pasted.includes('youtube.com') || pasted.includes('youtu.be')) {
    e.preventDefault();
    document.getElementById('urlInput').value = pasted;
  }
}

function handleUrlKeydown(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    fetchChannel();
  }
}

function showUrlInput() {
  const urlSection = document.getElementById('urlSection');
  const container = document.getElementById('channelsContainer');
  const calcContent = document.getElementById('calcContent');
  
  // If there are existing channels, move URL section into container at bottom
  // Otherwise, move it back to the top (first child of calcContent)
  if (state.channels.length > 0) {
    container.appendChild(urlSection);
  } else {
    calcContent.insertBefore(urlSection, calcContent.firstChild);
  }
  
  urlSection.classList.remove('hid');
  // Remove the dynamic add button if it exists
  const existingBtn = document.querySelector('.add-channel-btn');
  if (existingBtn) existingBtn.remove();
  document.getElementById('urlInput').value = 'https://youtube.com/@';
  document.getElementById('urlInput').focus();
  document.getElementById('fetchBtn').className = 'fetch';
  document.getElementById('fetchBtn').innerHTML = 'Fetch Videos';
  document.getElementById('fetchBtn').disabled = false;
}

async function fetchChannel() {
  let url = document.getElementById('urlInput').value.trim();
  if (!url || url === 'https://youtube.com/@') {
    document.getElementById('errMsg').textContent = 'Please enter a YouTube channel link';
    document.getElementById('errMsg').classList.remove('hid');
    return;
  }
  
  // Normalize URL - add @ if missing for handle-style URLs
  if (url.match(/youtube\.com\/[a-zA-Z0-9_-]+$/) && !url.includes('/@') && !url.includes('/channel/') && !url.includes('/c/') && !url.includes('/user/')) {
    url = url.replace(/youtube\.com\//, 'youtube.com/@');
    document.getElementById('urlInput').value = url;
  }
  
  // Check for duplicate
  if (state.channels.some(ch => ch.url === url)) {
    document.getElementById('errMsg').textContent = 'This channel has already been added';
    document.getElementById('errMsg').classList.remove('hid');
    return;
  }
  
  document.getElementById('loadingOverlay').classList.add('open');
  document.getElementById('errMsg').classList.add('hid');
  
  const progressBar = document.getElementById('loadProgress');
  progressBar.style.width = '0%';
  let progress = 0;
  const progressInterval = setInterval(() => {
    if (progress < 20) progress += 4;
    else if (progress < 50) progress += 2;
    else if (progress < 80) progress += 0.5;
    else if (progress < 90) progress += 0.2;
    progressBar.style.width = progress + '%';
  }, 200);
  
  try {
    const response = await fetch('https://n8n.srv962989.hstgr.cloud/webhook/hvo-youtube-fetch', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ channelUrl: url })
    });
    
    if (!response.ok) throw new Error('HTTP ' + response.status);
    
    const text = await response.text();
    if (!text) throw new Error('Empty response from server');
    
    let data;
    try {
      data = JSON.parse(text);
    } catch (e) {
      throw new Error('Invalid response: ' + text.substring(0, 100));
    }
    
    if (!data.backlogVideos || data.backlogVideos.length === 0) throw new Error('No videos found for this channel');
    
    clearInterval(progressInterval);
    progressBar.style.width = '100%';
    
    // Create new channel
    const channelId = ++channelIdCounter;
    const channel = {
      id: channelId,
      url: url,
      name: data.channelName || 'Channel',
      thumb: data.channelThumb || '',
      subs: data.subscriberCount || '',
      videos: data.backlogVideos || [],
      filteredVideos: [...(data.backlogVideos || [])],
      selected: new Set(),
      tier: null,
      rate: 0,
      calc: {}
    };
    
    state.channels.push(channel);
    state.currentChannelId = channelId;
    
    // Hide URL input
    document.getElementById('urlSection').classList.add('hid');
    
    // Render channel card (with speaker selection pending)
    renderChannelCard(channel, true);
    
    const totalMins = Math.round(channel.videos.reduce((s, v) => s + v.duration, 0) / 60);
    showToast({
      image: channel.thumb,
      title: channel.name + ' loaded',
      description: `${channel.videos.length} videos Â· ${totalMins.toLocaleString()} minutes`,
      duration: 4000
    });
    
  } catch (e) {
    clearInterval(progressInterval);
    progressBar.style.width = '0%';
    document.getElementById('errMsg').textContent = e.message;
    document.getElementById('errMsg').classList.remove('hid');
  } finally {
    setTimeout(() => {
      document.getElementById('loadingOverlay').classList.remove('open');
      document.getElementById('loadProgress').style.width = '0%';
    }, 300);
  }
}

// =====================
// CHANNEL CARD RENDERING
// =====================
function renderChannelCard(channel, pendingSpeaker = false) {
  const container = document.getElementById('channelsContainer');
  
  // Check if card already exists
  let card = document.getElementById(`channel-${channel.id}`);
  if (card) {
    card.remove();
  }
  
  card = document.createElement('div');
  card.id = `channel-${channel.id}`;
  card.className = 'ch-card' + (pendingSpeaker ? ' pending-speaker' : '');
  
  const selectedCount = channel.selected.size;
  const selectedMins = Math.round([...channel.selected].reduce((sum, id) => {
    const video = channel.videos.find(v => v.id === id);
    return sum + (video ? video.duration : 0);
  }, 0) / 60);
  
  card.innerHTML = `
    <button class="ch-close" onclick="removeChannel(${channel.id})" title="Remove channel">Ã—</button>
    <div class="ch-r">
      <div class="ch-i">
        <a href="${channel.url}" target="_blank" style="flex-shrink:0">
          <img class="ch-pfp" src="${channel.thumb}" alt="">
        </a>
        <div class="ch-info">
          <a href="${channel.url}" target="_blank" style="text-decoration:none;color:inherit">
            <h3>${escapeHtml(channel.name)}</h3>
          </a>
          <div class="ch-meta">
            <span class="ch-badge">${channel.subs} subscribers</span>
            ${channel.tier ? `
              <span class="ch-badge rate clickable" onclick="toggleSpeakerTooltip(event, ${channel.id})" title="Click to change">
                ${channel.tier} speakers Â· $${channel.rate}/min
                <span class="spk-tooltip hid" id="spk-tooltip-${channel.id}">
                  ${TIERS.filter(t => t !== '7+').map(tier => `
                    <button class="spk-opt${tier === channel.tier ? ' on' : ''}" onclick="updateSpeakerTier(event, ${channel.id}, '${tier}')">${tier}</button>
                  `).join('')}
                </span>
              </span>
            ` : ''}
          </div>
          <p class="ch-stats">${selectedCount} video${selectedCount !== 1 ? 's' : ''} selected Â· ${selectedMins.toLocaleString()} min</p>
        </div>
      </div>
      ${channel.tier ? `<button class="edit" onclick="openVideoModal(${channel.id})">Select Videos</button>` : ''}
    </div>
    ${pendingSpeaker ? renderSpeakerSelection(channel.id) : ''}
    ${channel.tier && selectedCount > 0 ? renderSelectedVideosList(channel) : ''}
  `;
  
  // Insert before add button if it exists, otherwise append
  const addBtn = container.querySelector('.add-channel-btn');
  if (addBtn) {
    container.insertBefore(card, addBtn);
  } else {
    container.appendChild(card);
  }
  
  if (pendingSpeaker) {
    card.classList.add('highlight');
    setTimeout(() => card.classList.remove('highlight'), 600);
  }
}

function renderSpeakerSelection(channelId) {
  return `
    <div class="speaker-select">
      <h4>How many main speakers appear in this channel's videos?</h4>
      <div class="spk-g">
        ${TIERS.map(tier => `
          <button class="spk" onclick="selectSpeakerTier(${channelId}, '${tier}')">${tier}</button>
        `).join('')}
      </div>
      <p class="spk-hint">Just the regulars. Guests get matched on the fly.</p>
      <div class="cust hid" id="cust-${channelId}">
        <p>For 7+ recurring speakers, please <a href="https://humanvoiceover.com/meetwithus" target="_blank">schedule a call</a> for custom pricing.</p>
      </div>
    </div>
  `;
}

function renderSelectedVideosList(channel) {
  const selected = channel.videos.filter(v => channel.selected.has(v.id));
  if (selected.length === 0) {
    return `<div class="sel-list"><div class="sel-empty">No videos selected. Click "Select Videos" to choose from your backlog.</div></div>`;
  }
  
  return `
    <div class="sel-list">
      ${selected.slice(0, 5).map(v => `
        <div class="sel-item">
          <img class="sel-thumb" src="${v.thumbnail || ''}" alt="">
          <div class="sel-info">
            <h4>${escapeHtml(v.title)}</h4>
            <p>${v.views} views</p>
          </div>
          <span class="sel-dur">${formatDuration(v.duration)}</span>
        </div>
      `).join('')}
      ${selected.length > 5 ? `<div class="sel-empty">+ ${selected.length - 5} more videos</div>` : ''}
    </div>
  `;
}

// =====================
// SPEAKER SELECTION
// =====================
function selectSpeakerTier(channelId, tier) {
  const channel = state.channels.find(ch => ch.id === channelId);
  if (!channel) return;
  
  const card = document.getElementById(`channel-${channelId}`);
  const buttons = card.querySelectorAll('.spk');
  buttons.forEach(btn => btn.classList.toggle('on', btn.textContent === tier));
  
  const custNotice = document.getElementById(`cust-${channelId}`);
  
  if (tier === '7+') {
    if (custNotice) custNotice.classList.remove('hid');
    return;
  }
  
  if (custNotice) custNotice.classList.add('hid');
  
  channel.tier = tier;
  channel.rate = PRICING[tier];
  
  // Re-render the card without speaker selection
  renderChannelCard(channel, false);
  
  // Show add channel button
  updateAddChannelButton();
  
  // Update results
  updateResults();
}

function renderSpeakerEditSelection(channelId, currentTier) {
  return `
    <h4>Change speaker count:</h4>
    <div class="spk-g">
      ${TIERS.filter(t => t !== '7+').map(tier => `
        <button class="spk${tier === currentTier ? ' on' : ''}" onclick="updateSpeakerTier(${channelId}, '${tier}')">${tier}</button>
      `).join('')}
    </div>
  `;
}

function toggleSpeakerTooltip(event, channelId) {
  event.stopPropagation();
  const tooltip = document.getElementById(`spk-tooltip-${channelId}`);
  
  // Close all other tooltips
  document.querySelectorAll('.spk-tooltip').forEach(t => {
    if (t.id !== `spk-tooltip-${channelId}`) t.classList.add('hid');
  });
  
  tooltip.classList.toggle('hid');
  
  // Close on outside click
  if (!tooltip.classList.contains('hid')) {
    setTimeout(() => {
      document.addEventListener('click', function closeTooltip(e) {
        if (!tooltip.contains(e.target)) {
          tooltip.classList.add('hid');
          document.removeEventListener('click', closeTooltip);
        }
      });
    }, 0);
  }
}

function updateSpeakerTier(event, channelId, tier) {
  event.stopPropagation();
  const channel = state.channels.find(ch => ch.id === channelId);
  if (!channel) return;
  
  channel.tier = tier;
  channel.rate = PRICING[tier];
  
  // Re-render the card
  renderChannelCard(channel, false);
  
  // Update results
  updateResults();
}

// =====================
// CHANNEL MANAGEMENT
// =====================
function removeChannel(channelId) {
  state.channels = state.channels.filter(ch => ch.id !== channelId);
  const card = document.getElementById(`channel-${channelId}`);
  if (card) card.remove();
  
  updateAddChannelButton();
  updateResults();
  
  // If no channels, show URL input
  if (state.channels.length === 0) {
    showUrlInput();
    document.getElementById('resultsSection').classList.add('hid');
  }
}

function updateAddChannelButton() {
  const container = document.getElementById('channelsContainer');
  const allComplete = state.channels.length > 0 && state.channels.every(ch => ch.tier && ch.tier !== '7+');
  
  // Remove existing add button if present
  const existingBtn = container.querySelector('.add-channel-btn');
  if (existingBtn) existingBtn.remove();
  
  if (allComplete) {
    // Create and append the add button
    const btn = document.createElement('button');
    btn.className = 'add-channel-btn';
    btn.onclick = showUrlInput;
    btn.innerHTML = '<span>+</span> Add Another Channel';
    container.appendChild(btn);
  }
}

// =====================
// LANGUAGE SELECTOR
// =====================
function updateLangFromSlider(value) {
  const n = parseInt(value);
  state.languages = n;
  
  // Update display
  document.getElementById('langNum').textContent = n;
  document.querySelector('.lang-label').textContent = n === 1 ? 'Language' : 'Languages';
  
  updateResults();
}

// =====================
// RESULTS CALCULATION
// =====================
function updateResults() {
  const completeChannels = state.channels.filter(ch => ch.tier && ch.tier !== '7+');
  
  // Check if all channels have videos selected
  const allChannelsHaveSelections = completeChannels.length > 0 && 
    completeChannels.every(ch => ch.selected.size > 0);
  
  // Show/hide quote section based on selections
  const resultsSection = document.getElementById('resultsSection');
  const quoteSection = document.getElementById('quoteSection');
  const ctaRow = document.getElementById('ctaRow');
  if (allChannelsHaveSelections) {
    resultsSection.classList.remove('hid');
    quoteSection.classList.remove('hid');
    ctaRow.classList.remove('hid');
  } else {
    resultsSection.classList.add('hid');
    quoteSection.classList.add('hid');
    ctaRow.classList.add('hid');
  }
  
  if (completeChannels.length === 0) return;
  
  let totalSelectedVideos = 0;
  let totalSourceMins = 0;
  let totalBacklogCost = 0;
  let totalVideos = 0;
  let totalDuration = 0;
  let totalMonths = 0;
  
  const channelBreakdowns = [];
  
  completeChannels.forEach(channel => {
    // Calculate channel-specific metrics
    const selectedVideos = channel.videos.filter(v => channel.selected.has(v.id));
    const sourceSecs = selectedVideos.reduce((s, v) => s + v.duration, 0);
    const sourceMins = Math.round(sourceSecs / 60);
    const dubbedMins = sourceMins * state.languages;
    const backlogCost = dubbedMins * channel.rate;
    
    // Calculate monthly output
    const allDates = channel.videos.map(v => new Date(v.publishedAt)).filter(d => !isNaN(d));
    let monthsActive = 1;
    if (allDates.length > 1) {
      const oldest = new Date(Math.min(...allDates));
      const newest = new Date(Math.max(...allDates));
      monthsActive = Math.max(1, Math.round((newest - oldest) / (1000 * 60 * 60 * 24 * 30)));
    }
    
    const channelTotalMins = Math.round(channel.videos.reduce((s, v) => s + v.duration, 0) / 60);
    const avgMonthlyMins = Math.round(channelTotalMins / monthsActive);
    const monthlyDubbed = avgMonthlyMins * state.languages;
    const monthlyCost = monthlyDubbed * channel.rate;
    
    // Store in channel
    channel.calc = {
      selectedVideos: selectedVideos.length,
      sourceMins,
      dubbedMins,
      backlogCost,
      totalVideos: channel.videos.length,
      avgLength: channel.videos.length > 0 ? Math.round(channelTotalMins / channel.videos.length) : 0,
      avgMonthlyMins,
      monthlyDubbed,
      monthlyCost,
      monthsActive
    };
    
    // Accumulate totals
    totalSelectedVideos += selectedVideos.length;
    totalSourceMins += sourceMins;
    totalBacklogCost += backlogCost;
    totalVideos += channel.videos.length;
    totalDuration += channelTotalMins;
    totalMonths = Math.max(totalMonths, monthsActive);
    
    channelBreakdowns.push({
      name: channel.name,
      thumb: channel.thumb,
      backlogCost,
      monthlyCost
    });
  });
  
  const avgLength = totalVideos > 0 ? Math.round(totalDuration / totalVideos) : 0;
  const avgMonthlyMins = totalMonths > 0 ? Math.round(totalDuration / totalMonths) : 0;
  const totalMonthlyDubbed = avgMonthlyMins * state.languages;
  
  // Calculate blended rate
  let totalMonthlyCost = 0;
  completeChannels.forEach(ch => {
    totalMonthlyCost += ch.calc.monthlyCost;
  });
  const blendedRate = totalMonthlyDubbed > 0 ? Math.round(totalMonthlyCost / totalMonthlyDubbed) : 45;
  
  // Update DOM
  document.getElementById('resVideos').textContent = totalSelectedVideos;
  document.getElementById('resSourceMins').textContent = totalSourceMins.toLocaleString();
  document.getElementById('resDubbedMins').textContent = (totalSourceMins * state.languages).toLocaleString();
  document.getElementById('resRate').textContent = blendedRate;
  document.getElementById('resBacklogCost').textContent = formatCurrency(totalBacklogCost);
  
  document.getElementById('resTotalVideos').textContent = totalVideos + ' over ' + totalMonths + ' mo';
  document.getElementById('resAvgLength').textContent = avgLength;
  document.getElementById('resMonthlyMins').textContent = avgMonthlyMins;
  document.getElementById('resMonthlyDubbed').textContent = totalMonthlyDubbed.toLocaleString();
  document.getElementById('resMonthlyCost').textContent = formatCurrency(totalMonthlyCost) + '/mo';
  
  // Update language displays
  document.getElementById('langNum').textContent = state.languages;
  document.querySelector('.lang-label').textContent = state.languages === 1 ? 'Language' : 'Languages';
  document.getElementById('resLangBack').textContent = state.languages;
  document.getElementById('resLangMonth').textContent = state.languages;
  
  // Render breakdowns if multiple channels
  const backlogBreakdown = document.getElementById('backlogBreakdown');
  const monthlyBreakdown = document.getElementById('monthlyBreakdown');
  
  if (channelBreakdowns.length > 1) {
    backlogBreakdown.innerHTML = channelBreakdowns.map(ch => `
      <div class="breakdown-row">
        <span><img src="${ch.thumb}" alt="">${escapeHtml(ch.name)}</span>
        <span>${formatCurrency(ch.backlogCost)}</span>
      </div>
    `).join('');
    
    monthlyBreakdown.innerHTML = channelBreakdowns.map(ch => `
      <div class="breakdown-row">
        <span><img src="${ch.thumb}" alt="">${escapeHtml(ch.name)}</span>
        <span>${formatCurrency(ch.monthlyCost)}/mo</span>
      </div>
    `).join('');
  } else {
    backlogBreakdown.innerHTML = '';
    monthlyBreakdown.innerHTML = '';
  }
}

// =====================
// VIDEO MODAL (SHADOW DOM)
// =====================
function createShadowModal() {
  const host = document.getElementById('video-modal-host');
  shadowRoot = host.attachShadow({ mode: 'open' });
  
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  
  shadowRoot.innerHTML = `
    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }
      
      :host {
        --bg: #ffffff; --bg2: #f8f8f8; --bg3: #f0f0f0; --bg4: #e5e5e5;
        --bdr: #e0e0e0; --txt: #111; --txt2: #555; --txt3: #888;
        --card-bg: #fff; --input-bg: #f5f5f5; --btn-bg: #e5e5e5;
      }
      
      .modal-overlay[data-theme="dark"] {
        --bg: #050505; --bg2: #0c0c0c; --bg3: #141414; --bg4: #1c1c1c;
        --bdr: #1a1a1a; --txt: #fff; --txt2: #a0a0a0; --txt3: #666;
        --card-bg: #0c0c0c; --input-bg: #1a1a1a; --btn-bg: #1a1a1a;
      }
      
      .modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.5);
        backdrop-filter: blur(8px); z-index: 999999;
        display: none; align-items: center; justify-content: center;
        padding: 20px; font-family: 'Switzer', system-ui, sans-serif;
      }
      .modal-overlay.open { display: flex; }
      
      .modal-box {
        background: var(--card-bg); border: 1px solid var(--bdr);
        border-radius: 18px; width: 100%; max-width: 950px;
        height: 85vh; display: flex; flex-direction: column; overflow: hidden;
      }
      
      .modal-header {
        flex: 0 0 auto; display: flex; align-items: center;
        justify-content: space-between; padding: 20px 24px;
        border-bottom: 1px solid var(--bdr);
      }
      .modal-header h3 { font-size: 16px; font-weight: 600; color: var(--txt); }
      .modal-stats { font-size: 16px; font-weight: 600; color: var(--txt); }
      .modal-stats .num { color: #dc2626; font-size: 20px; font-weight: 700; }
      
      .header-actions { display: flex; align-items: center; gap: 10px; }
      .action-btn {
        padding: 8px 14px; background: var(--btn-bg); border: 0;
        border-radius: 6px; color: var(--txt);
        font: 500 13px 'Switzer', sans-serif; cursor: pointer;
      }
      .action-btn:hover { background: var(--bg4); }
      
      .close-btn {
        width: 36px; height: 36px; display: flex; align-items: center;
        justify-content: center; background: 0; border: 0;
        color: var(--txt2); font-size: 24px; cursor: pointer; border-radius: 6px;
      }
      .close-btn:hover { background: var(--bg3); color: var(--txt); }
      
      .modal-toolbar {
        flex: 0 0 auto; padding: 14px 24px; border-bottom: 1px solid var(--bdr);
        display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
      }
      
      .search-input {
        flex: 1; min-width: 200px; max-width: 280px; padding: 8px 12px;
        background: var(--input-bg); border: 1px solid var(--bdr);
        border-radius: 6px; color: var(--txt); font: 14px 'Switzer', sans-serif;
      }
      .search-input::placeholder { color: var(--txt3); }
      .search-input:focus { outline: 0; border-color: #3b82f6; }
      
      .toolbar-label { font-size: 13px; color: var(--txt2); }
      
      .sort-select {
        padding: 8px 12px; background: var(--input-bg);
        border: 1px solid var(--bdr); border-radius: 6px;
        color: var(--txt); font: 500 13px 'Switzer', sans-serif; cursor: pointer;
      }
      
      .export-btn {
        padding: 8px 14px; background: var(--btn-bg);
        border: 1px solid var(--bdr); border-radius: 6px;
        color: var(--txt2); font: 500 13px 'Switzer', sans-serif;
        cursor: pointer; margin-left: auto;
      }
      .export-btn:hover { background: var(--bg4); color: var(--txt); }
      
      .modal-body { flex: 1; overflow-y: auto; padding: 24px; background: var(--bg2); }
      
      .modal-footer {
        flex: 0 0 auto; padding: 16px 24px;
        border-top: 1px solid var(--bdr); background: var(--card-bg);
      }
      
      .confirm-btn {
        width: 100%; padding: 14px; background: #dc2626; border: 0;
        border-radius: 10px; color: #fff; font: 700 15px 'Switzer', sans-serif;
        cursor: pointer;
      }
      .confirm-btn:hover { background: #b91c1c; }
      
      .video-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; }
      @media (max-width: 800px) { .video-grid { grid-template-columns: repeat(3, 1fr); } }
      @media (max-width: 550px) { .video-grid { grid-template-columns: repeat(2, 1fr); } }
      
      .video-card {
        border-radius: 10px; overflow: hidden; cursor: pointer;
        border: 2px solid transparent; background: var(--card-bg);
      }
      .video-card:hover { background: var(--bg3); border-color: var(--bdr); }
      .video-card.selected { border-color: #dc2626; }
      
      .video-thumb { position: relative; aspect-ratio: 16/9; background: var(--bg3); overflow: hidden; }
      .video-thumb img { width: 100%; height: 100%; object-fit: cover; }
      .video-thumb .duration {
        position: absolute; bottom: 6px; right: 6px; padding: 3px 6px;
        background: rgba(0,0,0,0.85); border-radius: 4px;
        font-size: 11px; font-weight: 600; color: #fff;
      }
      .video-thumb .checkmark {
        position: absolute; top: 8px; right: 8px; width: 24px; height: 24px;
        background: #dc2626; border-radius: 50%; display: none;
        align-items: center; justify-content: center; font-size: 14px; color: #fff;
      }
      .video-card.selected .checkmark { display: flex; }
      
      .video-info { padding: 12px; }
      .video-info h4 {
        font-size: 13px; font-weight: 500; line-height: 1.4;
        display: -webkit-box; -webkit-line-clamp: 2;
        -webkit-box-orient: vertical; overflow: hidden;
        margin-bottom: 6px; color: var(--txt);
      }
      .video-info p { font-size: 12px; color: var(--txt3); }
    </style>
    
    <div class="modal-overlay" id="shadow-modal" data-theme="${isDark ? 'dark' : ''}">
      <div class="modal-box">
        <div class="modal-header">
          <h3 id="modal-title">Select Backlog Videos</h3>
          <div class="modal-stats"><span class="num" id="modal-count">0</span> selected Â· <span class="num" id="modal-mins">0</span> min</div>
          <div class="header-actions">
            <button class="action-btn" id="select-all">Select All</button>
            <button class="action-btn" id="clear-all">Clear</button>
            <button class="close-btn" id="close-modal">Ã—</button>
          </div>
        </div>
        <div class="modal-toolbar">
          <input type="text" class="search-input" id="search-input" placeholder="Search videos...">
          <span class="toolbar-label">Sort:</span>
          <select class="sort-select" id="sort-select">
            <option value="views">Most Views</option>
            <option value="duration">Longest</option>
            <option value="newest">Newest</option>
            <option value="oldest">Oldest</option>
          </select>
          <span class="toolbar-label">Time:</span>
          <select class="sort-select" id="time-select">
            <option value="all">All Time</option>
            <option value="30">30 Days</option>
            <option value="90">90 Days</option>
            <option value="180">6 Months</option>
            <option value="365">1 Year</option>
            <option value="1095">3 Years</option>
          </select>
          <button class="export-btn" id="export-btn">Export CSV</button>
        </div>
        <div class="modal-body">
          <div class="video-grid" id="video-grid"></div>
        </div>
        <div class="modal-footer">
          <button class="confirm-btn" id="confirm-btn">Confirm Selection</button>
        </div>
      </div>
    </div>
  `;
  
  shadowModal = shadowRoot.getElementById('shadow-modal');
  shadowVgrid = shadowRoot.getElementById('video-grid');
  
  shadowRoot.getElementById('close-modal').addEventListener('click', closeVideoModal);
  shadowRoot.getElementById('select-all').addEventListener('click', selectAllVideos);
  shadowRoot.getElementById('clear-all').addEventListener('click', clearAllVideos);
  shadowRoot.getElementById('confirm-btn').addEventListener('click', confirmVideoSelection);
  shadowRoot.getElementById('search-input').addEventListener('input', debounce(e => filterVideos(e.target.value), 150));
  shadowRoot.getElementById('sort-select').addEventListener('change', e => sortVideos(e.target.value));
  shadowRoot.getElementById('time-select').addEventListener('change', e => filterByTime(e.target.value));
  shadowRoot.getElementById('export-btn').addEventListener('click', exportCSV);
  shadowModal.addEventListener('click', e => { if (e.target === shadowModal) closeVideoModal(); });
}

function openVideoModal(channelId) {
  const channel = state.channels.find(ch => ch.id === channelId);
  if (!channel || !shadowModal) return;
  
  state.currentChannelId = channelId;
  channel.filteredVideos = [...channel.videos];
  
  shadowRoot.getElementById('modal-title').textContent = `Select Videos â€” ${channel.name}`;
  shadowRoot.getElementById('search-input').value = '';
  shadowRoot.getElementById('time-select').value = 'all';
  
  updateShadowTheme();
  renderVideoGrid(channel);
  updateModalStats(channel);
  
  shadowModal.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeVideoModal() {
  if (shadowModal) shadowModal.classList.remove('open');
  document.body.style.overflow = '';
}

function renderVideoGrid(channel) {
  if (!shadowVgrid) return;
  shadowVgrid.innerHTML = '';
  
  channel.filteredVideos.forEach(v => {
    const card = document.createElement('div');
    card.className = 'video-card' + (channel.selected.has(v.id) ? ' selected' : '');
    card.dataset.id = v.id;
    card.addEventListener('click', () => toggleVideo(channel.id, v.id));
    card.innerHTML = `
      <div class="video-thumb">
        ${v.thumbnail ? `<img src="${v.thumbnail}" loading="lazy" alt="">` : ''}
        <div class="duration">${formatDuration(v.duration)}</div>
        <div class="checkmark">âœ“</div>
      </div>
      <div class="video-info">
        <h4>${escapeHtml(v.title)}</h4>
        <p>${v.views} Â· ${v.publishedAgo}</p>
      </div>
    `;
    shadowVgrid.appendChild(card);
  });
}

function toggleVideo(channelId, videoId) {
  const channel = state.channels.find(ch => ch.id === channelId);
  if (!channel) return;
  
  if (channel.selected.has(videoId)) {
    channel.selected.delete(videoId);
  } else {
    channel.selected.add(videoId);
  }
  
  const card = shadowVgrid.querySelector(`.video-card[data-id="${videoId}"]`);
  if (card) card.classList.toggle('selected', channel.selected.has(videoId));
  
  updateModalStats(channel);
}

function selectAllVideos() {
  const channel = state.channels.find(ch => ch.id === state.currentChannelId);
  if (!channel) return;
  
  channel.filteredVideos.forEach(v => channel.selected.add(v.id));
  shadowVgrid.querySelectorAll('.video-card').forEach(c => c.classList.add('selected'));
  updateModalStats(channel);
}

function clearAllVideos() {
  const channel = state.channels.find(ch => ch.id === state.currentChannelId);
  if (!channel) return;
  
  channel.selected.clear();
  shadowVgrid.querySelectorAll('.video-card').forEach(c => c.classList.remove('selected'));
  updateModalStats(channel);
}

function updateModalStats(channel) {
  const count = channel.selected.size;
  const mins = Math.round([...channel.selected].reduce((sum, id) => {
    const video = channel.videos.find(v => v.id === id);
    return sum + (video ? video.duration : 0);
  }, 0) / 60);
  
  shadowRoot.getElementById('modal-count').textContent = count;
  shadowRoot.getElementById('modal-mins').textContent = mins.toLocaleString();
}

function confirmVideoSelection() {
  const channel = state.channels.find(ch => ch.id === state.currentChannelId);
  if (channel) {
    renderChannelCard(channel, false);
    updateResults();
  }
  closeVideoModal();
}

function filterVideos(query) {
  const channel = state.channels.find(ch => ch.id === state.currentChannelId);
  if (!channel) return;
  
  const lq = query.toLowerCase();
  shadowVgrid.querySelectorAll('.video-card').forEach(card => {
    const title = card.querySelector('h4').textContent.toLowerCase();
    card.style.display = title.includes(lq) ? '' : 'none';
  });
}

function sortVideos(sortBy) {
  const channel = state.channels.find(ch => ch.id === state.currentChannelId);
  if (!channel) return;
  
  if (sortBy === 'views') channel.filteredVideos.sort((a, b) => b.viewCount - a.viewCount);
  else if (sortBy === 'duration') channel.filteredVideos.sort((a, b) => b.duration - a.duration);
  else if (sortBy === 'newest') channel.filteredVideos.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
  else if (sortBy === 'oldest') channel.filteredVideos.sort((a, b) => new Date(a.publishedAt) - new Date(b.publishedAt));
  
  renderVideoGrid(channel);
}

function filterByTime(days) {
  const channel = state.channels.find(ch => ch.id === state.currentChannelId);
  if (!channel) return;
  
  if (days === 'all') {
    channel.filteredVideos = [...channel.videos];
  } else {
    const now = new Date();
    const cutoff = new Date(now.getTime() - parseInt(days) * 24 * 60 * 60 * 1000);
    channel.filteredVideos = channel.videos.filter(v => new Date(v.publishedAt) >= cutoff);
  }
  
  renderVideoGrid(channel);
}

function exportCSV() {
  const channel = state.channels.find(ch => ch.id === state.currentChannelId);
  if (!channel || channel.selected.size === 0) {
    alert('No videos selected');
    return;
  }
  
  const selected = channel.videos.filter(v => channel.selected.has(v.id));
  const headers = ['Video Title', 'Link', 'Length (min)', 'Views', 'Published Date'];
  const rows = selected.map(v => {
    const pubDate = v.publishedAt ? new Date(v.publishedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : '';
    return [`"${v.title.replace(/"/g, '""')}"`, `https://youtube.com/watch?v=${v.id}`, Math.round(v.duration / 60), v.viewCount, pubDate];
  });
  
  const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${channel.name.replace(/[^a-z0-9]/gi, '_')}_backlog.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

// =====================
// EMAIL & SCHEDULE MODALS
// =====================
function openEmailModal() {
  const completeChannels = state.channels.filter(ch => ch.tier && ch.tier !== '7+');
  if (completeChannels.length === 0) return;
  
  const names = completeChannels.map(ch => ch.name).join(' + ');
  let totalBacklog = 0, totalMonthly = 0;
  completeChannels.forEach(ch => {
    totalBacklog += ch.calc.backlogCost || 0;
    totalMonthly += ch.calc.monthlyCost || 0;
  });
  
  document.getElementById('emailChannels').textContent = names;
  document.getElementById('emailBacklog').textContent = formatCurrency(totalBacklog);
  document.getElementById('emailMonthly').textContent = formatCurrency(totalMonthly) + '/mo';
  document.getElementById('emailDetails').textContent = `${state.languages} languages Â· ${completeChannels.length} channel${completeChannels.length > 1 ? 's' : ''}`;
  
  document.getElementById('emailForm').classList.remove('hid');
  document.getElementById('emailSuccess').classList.add('hid');
  document.getElementById('emailModal').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function openScheduleModal() {
  const completeChannels = state.channels.filter(ch => ch.tier && ch.tier !== '7+');
  if (completeChannels.length === 0) return;
  
  const names = completeChannels.map(ch => ch.name).join(' + ');
  let totalBacklog = 0, totalMonthly = 0;
  completeChannels.forEach(ch => {
    totalBacklog += ch.calc.backlogCost || 0;
    totalMonthly += ch.calc.monthlyCost || 0;
  });
  
  document.getElementById('scheduleChannels').textContent = names;
  document.getElementById('scheduleBacklog').textContent = formatCurrency(totalBacklog);
  document.getElementById('scheduleMonthly').textContent = formatCurrency(totalMonthly) + '/mo';
  document.getElementById('scheduleDetails').textContent = `${state.languages} languages Â· ${completeChannels.length} channel${completeChannels.length > 1 ? 's' : ''}`;
  
  document.getElementById('scheduleForm').classList.remove('hid');
  document.getElementById('scheduleSuccess').classList.add('hid');
  document.getElementById('scheduleModal').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('open');
  document.body.style.overflow = '';
}

function closeModalOut(event, modalId) {
  if (event.target === document.getElementById(modalId)) closeModal(modalId);
}

async function sendQuote() {
  const email = document.getElementById('emailInput').value.trim();
  if (!email) return;
  
  const sendBtn = document.querySelector('#emailForm .send');
  sendBtn.innerHTML = 'Sending...';
  sendBtn.disabled = true;
  
  try {
    const payload = buildQuotePayload(email, 'email');
    const response = await fetch('https://n8n.srv962989.hstgr.cloud/webhook/hvo-quote-submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) throw new Error('Failed to send');
    
    document.getElementById('emailForm').classList.add('hid');
    document.getElementById('emailSuccess').classList.remove('hid');
    setTimeout(() => closeModal('emailModal'), 3000);
  } catch (e) {
    console.error(e);
    sendBtn.innerHTML = 'ðŸ“§ Send Quote';
    sendBtn.disabled = false;
    alert('Failed to send quote. Please try again.');
  }
}

async function submitSchedule() {
  const email = document.getElementById('scheduleEmailInput').value.trim();
  if (!email) return;
  
  const sendBtn = document.querySelector('#scheduleForm .send');
  sendBtn.innerHTML = 'Sending...';
  sendBtn.disabled = true;
  
  try {
    const payload = buildQuotePayload(email, 'schedule');
    const response = await fetch('https://n8n.srv962989.hstgr.cloud/webhook/hvo-quote-submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (!response.ok) throw new Error('Failed to send');
    
    document.getElementById('scheduleForm').classList.add('hid');
    document.getElementById('scheduleSuccess').classList.remove('hid');
    setTimeout(() => {
      closeModal('scheduleModal');
      window.open('https://humanvoiceover.com/meetwithus', '_blank');
    }, 1500);
  } catch (e) {
    console.error(e);
    sendBtn.innerHTML = 'ðŸ“… Continue to Scheduling';
    sendBtn.disabled = false;
    alert('Failed to save quote. Please try again.');
  }
}

function buildQuotePayload(email, action) {
  const completeChannels = state.channels.filter(ch => ch.tier && ch.tier !== '7+');
  
  let totalBacklog = 0, totalMonthly = 0;
  const channelsData = completeChannels.map(ch => {
    totalBacklog += ch.calc.backlogCost || 0;
    totalMonthly += ch.calc.monthlyCost || 0;
    
    const selectedVideos = ch.videos.filter(v => ch.selected.has(v.id)).map(v => ({
      title: v.title,
      id: v.id,
      duration: v.duration,
      durationMin: Math.round(v.duration / 60),
      views: v.views,
      viewCount: v.viewCount,
      publishedAt: v.publishedAt,
      thumbnail: v.thumbnail
    }));
    
    return {
      channelName: ch.name,
      channelUrl: ch.url,
      channelThumb: ch.thumb,
      speakerTier: ch.tier,
      rate: ch.rate,
      backlogVideos: ch.selected.size,
      backlogSourceMinutes: ch.calc.sourceMins,
      backlogDubbedMinutes: ch.calc.dubbedMins,
      backlogCost: ch.calc.backlogCost,
      totalVideos: ch.calc.totalVideos,
      avgVideoLength: ch.calc.avgLength,
      avgMonthlyMinutes: ch.calc.avgMonthlyMins,
      avgMonthlyDubbed: ch.calc.monthlyDubbed,
      avgMonthlyRate: ch.calc.monthlyCost,
      monthsActive: ch.calc.monthsActive,
      selectedVideos
    };
  });
  
  return {
    email,
    action,
    languages: state.languages,
    totalBacklogCost: totalBacklog,
    totalMonthlyCost: totalMonthly,
    channels: channelsData
  };
}

// =====================
// UTILITIES
// =====================
function debounce(fn, delay) {
  let timer = null;
  return function(...args) {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
}

function formatCurrency(n) {
  if (n >= 1e6) return '$' + (n / 1e6).toFixed(2) + 'M';
  if (n >= 1e3) return '$' + Math.round(n / 1e3).toLocaleString() + 'K';
  return '$' + n.toLocaleString();
}

function formatDuration(s) {
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const sec = s % 60;
  return h > 0 ? `${h}:${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}` : `${m}:${String(sec).padStart(2, '0')}`;
}

function escapeHtml(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

// =====================
// KEYBOARD SHORTCUTS
// =====================
document.addEventListener('keydown', e => {
  if (e.key === 'i' || e.key === 'I') {
    if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
      e.preventDefault();
      const infoPanel = document.getElementById('infoPanel');
      if (infoPanel.classList.contains('open')) showCalc();
      else showInfo();
    }
  }
  if (e.key === 'Escape') {
    const infoPanel = document.getElementById('infoPanel');
    if (infoPanel.classList.contains('open')) showCalc();
    closeVideoModal();
    closeModal('emailModal');
    closeModal('scheduleModal');
  }
});
</script>
</body>
</html>
